- name:
  hosts: 'fpp'
  tasks:

    # TO DO: Don't need to check prereqs multiple times - figure out how to structure. Maybe a flag to indicate already checked?

    - name: 'Check Client Prerequistes'
      include_role:
        name: 'fpp_common'
        tasks_from: 'check_client_prereq.yml'
    
    - name: 'Check if Source Home is WC'
      include_role:
        name: 'fpp_common'
        tasks_from: 'wc_query.yml'
      vars:
        wc_name: 'wc_{{ source_image }}_{{ cluster_name }}'
    
    - name: 'Check if New Home is WC'
      include_role:
        name: 'fpp_common'
        tasks_from: 'wc_query.yml'
      vars:
        wc_name: 'wc_{{ image_name }}_{{ cluster_name }}'

    # TO DO: Loop through for a list of databases? Or run each playbook once per database?

    - name: 'Patch Database'
      include_role:
        name: 'rdbms'
        tasks_from: 'rdbms_patch.yml'


# TO DO: Confirm database was moved to the new patched home/workingcopy using 'dbaascli dbhome info --hname <home name>'.
# To be run from db host? --> if not run from rdbms role