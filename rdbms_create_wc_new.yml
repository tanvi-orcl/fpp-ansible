# This playbook adds a new working copy. It will need to be run once per dbhome per cluster. 
  
- name:
  hosts: '{{ exa_group }}'
  tasks:

    - name: 'Assert general variables are defined.'
      assert:
        that: 
          - fpp_host is defined and identity_file is defined
          - exadata_type is defined and ( exadata_type == 'exacc' or exadata_type == 'exacs')
    
    - name: 'Assert Create WC New variables are defined.'
      assert:
        that:
          - image_name is defined and version is defined and version_tag is defined

    - name: 'Check if Provided Image Exists'
      import_role:
        name: 'fpp_common'
        tasks_from: 'image_query.yml'
      delegate_to: '{{ fpp_host }}'
      run_once: 'true'
      any_errors_fatal: 'true'

    - name: 'Check Client Prerequistes'
      import_role:
        name: 'fpp_common'
        tasks_from: 'check_client_prereq.yml'
      vars:
        target_node: '{{ ansible_hostname }}'
      delegate_to: '{{ fpp_host }}'
    
    - name: 'Create RDBMS WC'
      include_role:
        name: 'rdbms_fpp'
        tasks_from: 'rdbms_wc_create.yml'

      

    