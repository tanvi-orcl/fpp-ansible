- name: 'check dbhome'
  become: 'true'
  become_user: 'root'
  become_method: 'sudo'
  shell:  |
    {{ dbaascli_path }} dbhome info --hname {{ db_home_name }} --noprompt YES
  register: 'dbhome_info_result'
- debug:
    msg: '{{ dbhome_info_result }}'

- name: 'Set oracle_home, ru_version if {{ db_home_name }} exists'
  block:
  - set_fact:
      oracle_home: '{{ dbhome_info_result.stdout | regex_findall("HOME_LOC=(.+?)\n") | first }}'
      ru_version: '{{ dbhome_info_result.stdout | regex_findall("VERSION=(.+?)\n") | first }}'
  - debug:
      var: 'oracle_home'
  - debug:
      var: 'ru_version'
  when: dbhome_info_result.stdout | regex_search("HOME_NAME")