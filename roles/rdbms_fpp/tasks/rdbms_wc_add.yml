
- name: 'Find DB Groups'
  when: osdbagrp_groups is not defined
  include_role:
    name: 'target_commands'
    tasks_from: 'map_groups.yml'
  vars:
    image_type: 'db'
    target_user: 'oracle'

- name: 'Find Oracle Base'
  become: 'true'
  become_user: 'root'
  become_method: 'sudo'
  shell:  |
    ./orabase
  args:
    chdir: '{{ oracle_home }}/bin'
  environment:
    ORACLE_HOME: '{{ oracle_home }}'
  register: 'oracle_base_result'
- debug:
    msg: '{{ oracle_base_result }}'
- set_fact:
    oracle_base: '{{ oracle_base_result.stdout }}'

# changed to include
- block:
  - name: 'Add RDBMS Workingcopy {{ wc_name }}'
    include_role:
      name: 'fpp_common'
      tasks_from: 'wc_add.yml'
    vars:
      target_node: '{{ ansible_hostname }}'
      path: '{{ oracle_home }}'
      add_wc_param: '-skipclone -oraclebase {{ oracle_base }} -user oracle'

  - name: 'Query RDBMS Workingcopy {{ wc_name }}'
    include_role:
      name: 'fpp_common'
      tasks_from: 'wc_query.yml'
  delegate_to: '{{ fpp_host }}'